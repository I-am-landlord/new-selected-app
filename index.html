<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í–∏–±—ñ—Ä –∫–æ–º–∞–Ω–¥–∏</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            max-width: 500px;
            width: 100%;
            text-align: center;
        }

        h1 {
            color: #333;
            margin-bottom: 30px;
            font-size: 2.5em;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .team-buttons {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 30px;
        }

        .team-button {
            background: linear-gradient(45deg, #4facfe 0%, #00f2fe 100%);
            border: none;
            border-radius: 15px;
            padding: 20px;
            font-size: 1.2em;
            font-weight: bold;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .team-button:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(79, 172, 254, 0.3);
        }

        .team-button:disabled {
            background: linear-gradient(45deg, #ccc 0%, #999 100%);
            cursor: not-allowed;
            opacity: 0.6;
        }

        .team-button.team-2 {
            background: linear-gradient(45deg, #fa709a 0%, #fee140 100%);
        }

        .team-button.team-2:hover:not(:disabled) {
            box-shadow: 0 10px 20px rgba(250, 112, 154, 0.3);
        }

        .team-button.team-3 {
            background: linear-gradient(45deg, #a8edea 0%, #fed6e3 100%);
        }

        .team-button.team-3:hover:not(:disabled) {
            box-shadow: 0 10px 20px rgba(168, 237, 234, 0.3);
        }

        .participant-count {
            font-size: 0.9em;
            opacity: 0.9;
            margin-top: 5px;
        }

        .message {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            font-weight: bold;
            display: none;
        }

        .success {
            background: rgba(76, 175, 80, 0.1);
            border: 2px solid #4CAF50;
            color: #2E7D32;
        }

        .error {
            background: rgba(244, 67, 54, 0.1);
            border: 2px solid #f44336;
            color: #C62828;
        }

        .loading {
            background: rgba(255, 193, 7, 0.1);
            border: 2px solid #FFC107;
            color: #F57F17;
        }

        .loader {
            display: none;
            margin: 20px auto;
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .status-bar {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .status-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }

        .team-status {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.9em;
        }

        .refresh-button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            color: white;
            cursor: pointer;
            font-size: 0.9em;
            margin-top: 10px;
            transition: all 0.3s ease;
        }

        .refresh-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üèÜ –í–∏–±—ñ—Ä –∫–æ–º–∞–Ω–¥–∏</h1>
        
        <div class="status-bar">
            <div class="status-title">üìä –°—Ç–∞—Ç—É—Å –∫–æ–º–∞–Ω–¥</div>
            <div class="team-status">
                <span>–ö–æ–º–∞–Ω–¥–∞ 1:</span>
                <span id="team1-count">0/30</span>
            </div>
            <div class="team-status">
                <span>–ö–æ–º–∞–Ω–¥–∞ 2:</span>
                <span id="team2-count">0/30</span>
            </div>
            <div class="team-status">
                <span>–ö–æ–º–∞–Ω–¥–∞ 3:</span>
                <span id="team3-count">0/30</span>
            </div>
            <button class="refresh-button" onclick="updateTeamCounts()">üîÑ –û–Ω–æ–≤–∏—Ç–∏</button>
        </div>

        <div class="team-buttons">
            <button class="team-button" id="team1-btn" onclick="joinTeam(1)">
                üîµ –ö–æ–º–∞–Ω–¥–∞ 1
                <div class="participant-count" id="team1-participants">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
            </button>
            
            <button class="team-button team-2" id="team2-btn" onclick="joinTeam(2)">
                üî¥ –ö–æ–º–∞–Ω–¥–∞ 2
                <div class="participant-count" id="team2-participants">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
            </button>
            
            <button class="team-button team-3" id="team3-btn" onclick="joinTeam(3)">
                üü¢ –ö–æ–º–∞–Ω–¥–∞ 3
                <div class="participant-count" id="team3-participants">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
            </button>
        </div>

        <div class="loader" id="loader"></div>
        <div class="message" id="message"></div>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–Ω—ñ –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è —Å—Ç–∞–Ω—É –∫–æ–º–∞–Ω–¥
        let teamData = { team1: 0, team2: 0, team3: 0 };
        
        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏
        document.addEventListener('DOMContentLoaded', function() {
            updateTeamCounts();
        });

        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—ñ–ª—å–∫–æ—Å—Ç—ñ —É—á–∞—Å–Ω–∏–∫—ñ–≤
        async function updateTeamCounts() {
            try {
                showLoader(true);
                
                // –°–∏–º—É–ª—è—Ü—ñ—è API –∑–∞–ø–∏—Ç—É (–∑–∞–º—ñ–Ω—ñ—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω–∏–π endpoint)
                const response = await fetch('/.netlify/functions/get-teams', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error('–ü–æ–º–∏–ª–∫–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö');
                }

                const data = await response.json();
                teamData = data;

                // –û–Ω–æ–≤–ª–µ–Ω–Ω—è UI
                updateUI();
                showLoader(false);
                
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞:', error);
                showMessage('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö. –°–ø—Ä–æ–±—É–π—Ç–µ –ø—ñ–∑–Ω—ñ—à–µ.', 'error');
                showLoader(false);
                
                // Fallback - –ø–æ–∫–∞–∑—É—î–º–æ –±–∞–∑–æ–≤—ñ –¥–∞–Ω—ñ
                updateUI();
            }
        }

        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É
        function updateUI() {
            // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–Ω–æ–ø–æ–∫
            updateButton('team1', teamData.team1 || 0);
            updateButton('team2', teamData.team2 || 0);
            updateButton('team3', teamData.team3 || 0);

            // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞—Ç—É—Å-–±–∞—Ä—É
            document.getElementById('team1-count').textContent = `${teamData.team1 || 0}/30`;
            document.getElementById('team2-count').textContent = `${teamData.team2 || 0}/30`;
            document.getElementById('team3-count').textContent = `${teamData.team3 || 0}/30`;
        }

        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –æ–∫—Ä–µ–º–æ—ó –∫–Ω–æ–ø–∫–∏
        function updateButton(teamId, count) {
            const button = document.getElementById(`${teamId}-btn`);
            const participantCount = document.getElementById(`${teamId}-participants`);
            
            participantCount.textContent = `–£—á–∞—Å–Ω–∏–∫—ñ–≤: ${count}/30`;
            
            if (count >= 30) {
                button.disabled = true;
                participantCount.textContent += ' (–ü–û–í–ù–ê)';
            } else {
                button.disabled = false;
            }
        }

        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –ø—Ä–∏—î–¥–Ω–∞–Ω–Ω—è –¥–æ –∫–æ–º–∞–Ω–¥–∏
        async function joinTeam(teamNumber) {
            try {
                showLoader(true);
                hideMessage();

                const response = await fetch('/.netlify/functions/join-team', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        team: teamNumber,
                        timestamp: Date.now(),
                        userAgent: navigator.userAgent
                    })
                });

                const result = await response.json();

                if (response.ok && result.success) {
                    showMessage(`‚úÖ –í–∏ —É—Å–ø—ñ—à–Ω–æ –ø—Ä–∏—î–¥–Ω–∞–ª–∏—Å—è –¥–æ –ö–æ–º–∞–Ω–¥–∏ ${teamNumber}!`, 'success');
                    
                    // –û–Ω–æ–≤–ª—é—î–º–æ –ª–æ–∫–∞–ª—å–Ω—ñ –¥–∞–Ω—ñ
                    teamData[`team${teamNumber}`] = result.newCount;
                    updateUI();
                    
                } else {
                    if (result.error === 'TEAM_FULL') {
                        showMessage(`‚ùå –ö–æ–º–∞–Ω–¥–∞ ${teamNumber} –≤–∂–µ –ø–æ–≤–Ω–∞ (30 —É—á–∞—Å–Ω–∏–∫—ñ–≤). –û–±–µ—Ä—ñ—Ç—å —ñ–Ω—à—É –∫–æ–º–∞–Ω–¥—É.`, 'error');
                    } else {
                        showMessage('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏—î–¥–Ω–∞–Ω–Ω—è –¥–æ –∫–æ–º–∞–Ω–¥–∏. –°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑.', 'error');
                    }
                }

                showLoader(false);
                
                // –û–Ω–æ–≤–ª—é—î–º–æ –¥–∞–Ω—ñ —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó
                setTimeout(updateTeamCounts, 1000);

            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞:', error);
                showMessage('–ü–æ–º–∏–ª–∫–∞ –∑\'—î–¥–Ω–∞–Ω–Ω—è –∑ —Å–µ—Ä–≤–µ—Ä–æ–º. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç —ñ —Å–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑.', 'error');
                showLoader(false);
            }
        }

        // –î–æ–ø–æ–º—ñ–∂–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –¥–ª—è UI
        function showMessage(text, type) {
            const message = document.getElementById('message');
            message.textContent = text;
            message.className = `message ${type}`;
            message.style.display = 'block';
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–∏—Ö–æ–≤—É—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(hideMessage, 5000);
        }

        function hideMessage() {
            document.getElementById('message').style.display = 'none';
        }

        function showLoader(show) {
            document.getElementById('loader').style.display = show ? 'block' : 'none';
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–∂–Ω—ñ 30 —Å–µ–∫—É–Ω–¥
        setInterval(updateTeamCounts, 30000);
    </script>
</body>
</html>